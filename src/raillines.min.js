!function(){"use strict";function c(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function t(t,n){return t(n={exports:{}},n.exports),n.exports}var g=t(function(t){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)}),v=t(function(t){var n=t.exports={version:"2.6.3"};"number"==typeof __e&&(__e=n)}),i=(v.version,function(t){return"object"==typeof t?null!==t:"function"==typeof t}),a=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t},e=function(t){try{return!!t()}catch(t){return!0}},n=!e(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),r=g.document,o=i(r)&&i(r.createElement),u=function(t){return o?r.createElement(t):{}},l=!n&&!e(function(){return 7!=Object.defineProperty(u("div"),"a",{get:function(){return 7}}).a}),s=Object.defineProperty,f={f:n?Object.defineProperty:function(t,n,e){if(a(t),n=function(t,n){if(!i(t))return t;var e,r;if(n&&"function"==typeof(e=t.toString)&&!i(r=e.call(t)))return r;if("function"==typeof(e=t.valueOf)&&!i(r=e.call(t)))return r;if(!n&&"function"==typeof(e=t.toString)&&!i(r=e.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(n,!0),a(e),l)try{return s(t,n,e)}catch(t){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[n]=e.value),t}},_=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}},S=n?function(t,n,e){return f.f(t,n,_(1,e))}:function(t,n,e){return t[n]=e,t},p={}.hasOwnProperty,d=function(t,n){return p.call(t,n)},y=0,h=Math.random(),m=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++y+h).toString(36))},j=t(function(t){var o=m("src"),n="toString",e=Function[n],a=(""+e).split(n);v.inspectSource=function(t){return e.call(t)},(t.exports=function(t,n,e,r){var i="function"==typeof e;i&&(d(e,"name")||S(e,"name",n)),t[n]!==e&&(i&&(d(e,o)||S(e,o,t[n]?""+t[n]:a.join(String(n)))),t===g?t[n]=e:r?t[n]?t[n]=e:S(t,n,e):(delete t[n],S(t,n,e)))})(Function.prototype,n,function(){return"function"==typeof this&&this[o]||e.call(this)})}),b=function(r,i,t){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(r),void 0===i)return r;switch(t){case 1:return function(t){return r.call(i,t)};case 2:return function(t,n){return r.call(i,t,n)};case 3:return function(t,n,e){return r.call(i,t,n,e)}}return function(){return r.apply(i,arguments)}},O="prototype",x=function(t,n,e){var r,i,o,a,u=t&x.F,c=t&x.G,l=t&x.S,s=t&x.P,f=t&x.B,p=c?g:l?g[n]||(g[n]={}):(g[n]||{})[O],d=c?v:v[n]||(v[n]={}),y=d[O]||(d[O]={});for(r in c&&(e=n),e)o=((i=!u&&p&&void 0!==p[r])?p:e)[r],a=f&&i?b(o,g):s&&"function"==typeof o?b(Function.call,o):o,p&&j(p,r,o,t&x.U),d[r]!=o&&S(d,r,a),s&&y[r]!=o&&(y[r]=o)};g.core=v,x.F=1,x.G=2,x.S=4,x.P=8,x.B=16,x.W=32,x.U=64,x.R=128;var T=x,w={}.toString,P=function(t){return w.call(t).slice(8,-1)},L=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==P(t)?t.split(""):Object(t)},A=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},k=function(t){return Object(A(t))},M=Math.ceil,C=Math.floor,E=function(t){return isNaN(t=+t)?0:(0<t?C:M)(t)},F=Math.min,I=function(t){return 0<t?F(E(t),9007199254740991):0},D=Array.isArray||function(t){return"Array"==P(t)},R=t(function(t){var n="__core-js_shared__",e=g[n]||(g[n]={});(t.exports=function(t,n){return e[t]||(e[t]=void 0!==n?n:{})})("versions",[]).push({version:v.version,mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),V=t(function(t){var n=R("wks"),e=g.Symbol,r="function"==typeof e;(t.exports=function(t){return n[t]||(n[t]=r&&e[t]||(r?e:m)("Symbol."+t))}).store=n}),B=V("species"),G=function(t,n){return D(e=t)&&("function"!=typeof(r=e.constructor)||r!==Array&&!D(r.prototype)||(r=void 0),i(r)&&null===(r=r[B])&&(r=void 0)),new(void 0===r?Array:r)(n);var e,r},z=function(f,t){var p=1==f,d=2==f,y=3==f,g=4==f,v=6==f,h=5==f||v,m=t||G;return function(t,n,e){for(var r,i,o=k(t),a=L(o),u=b(n,e,3),c=I(a.length),l=0,s=p?m(t,c):d?m(t,0):void 0;l<c;l++)if((h||l in a)&&(i=u(r=a[l],l,o),f))if(p)s[l]=i;else if(i)switch(f){case 3:return!0;case 5:return r;case 6:return l;case 2:s.push(r)}else if(g)return!1;return v?-1:y||g?g:s}},N=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})},H=z(2);T(T.P+T.F*!N([].filter,!0),"Array",{filter:function(t){return H(this,t,arguments[1])}});var K=function(t){return L(A(t))},U=Math.max,W=Math.min,q=function(l){return function(t,n,e){var r,i,o,a=K(t),u=I(a.length),c=(i=u,(r=E(r=e))<0?U(r+i,0):W(r,i));if(l&&n!=n){for(;c<u;)if((o=a[c++])!=o)return!0}else for(;c<u;c++)if((l||c in a)&&a[c]===n)return l||c||0;return!l&&-1}},Q=q(!1),J=[].indexOf,X=!!J&&1/[1].indexOf(1,-0)<0;T(T.P+T.F*(X||!N(J)),"Array",{indexOf:function(t){return X?J.apply(this,arguments)||0:Q(this,t,arguments[1])}});var Y=z(1);T(T.P+T.F*!N([].map,!0),"Array",{map:function(t){return Y(this,t,arguments[1])}});var Z=V("unscopables"),tt=Array.prototype;null==tt[Z]&&S(tt,Z,{});var nt=function(t){tt[Z][t]=!0},et=function(t,n){return{value:n,done:!!t}},rt={},it=R("keys"),ot=function(t){return it[t]||(it[t]=m(t))},at=q(!1),ut=ot("IE_PROTO"),ct="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),lt=Object.keys||function(t){return function(t,n){var e,r=K(t),i=0,o=[];for(e in r)e!=ut&&d(r,e)&&o.push(e);for(;n.length>i;)d(r,e=n[i++])&&(~at(o,e)||o.push(e));return o}(t,ct)},st=n?Object.defineProperties:function(t,n){a(t);for(var e,r=lt(n),i=r.length,o=0;o<i;)f.f(t,e=r[o++],n[e]);return t},ft=g.document,pt=ft&&ft.documentElement,dt=ot("IE_PROTO"),yt=function(){},gt="prototype",vt=function(){var t,n=u("iframe"),e=ct.length;for(n.style.display="none",pt.appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),vt=t.F;e--;)delete vt[gt][ct[e]];return vt()},ht=Object.create||function(t,n){var e;return null!==t?(yt[gt]=a(t),e=new yt,yt[gt]=null,e[dt]=t):e=vt(),void 0===n?e:st(e,n)},mt=f.f,bt=V("toStringTag"),Ot=function(t,n,e){t&&!d(t=e?t:t.prototype,bt)&&mt(t,bt,{configurable:!0,value:n})},xt={};S(xt,V("iterator"),function(){return this});var _t=ot("IE_PROTO"),St=Object.prototype,jt=Object.getPrototypeOf||function(t){return t=k(t),d(t,_t)?t[_t]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?St:null},Tt=V("iterator"),wt=!([].keys&&"next"in[].keys()),Pt="values",Lt=function(){return this},At=function(t,n,e,r,i,o,a){var u,c,l;c=n,l=r,(u=e).prototype=ht(xt,{next:_(1,l)}),Ot(u,c+" Iterator");var s,f,p,d=function(t){if(!wt&&t in h)return h[t];switch(t){case"keys":case Pt:return function(){return new e(this,t)}}return function(){return new e(this,t)}},y=n+" Iterator",g=i==Pt,v=!1,h=t.prototype,m=h[Tt]||h["@@iterator"]||i&&h[i],b=m||d(i),O=i?g?d("entries"):b:void 0,x="Array"==n&&h.entries||m;if(x&&(p=jt(x.call(new t)))!==Object.prototype&&p.next&&(Ot(p,y,!0),"function"!=typeof p[Tt]&&S(p,Tt,Lt)),g&&m&&m.name!==Pt&&(v=!0,b=function(){return m.call(this)}),(wt||v||!h[Tt])&&S(h,Tt,b),rt[n]=b,rt[y]=Lt,i)if(s={values:g?b:d(Pt),keys:o?b:d("keys"),entries:O},a)for(f in s)f in h||j(h,f,s[f]);else T(T.P+T.F*(wt||v),n,s);return s}(Array,"Array",function(t,n){this._t=K(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,e=this._i++;return!t||e>=t.length?(this._t=void 0,et(1)):et(0,"keys"==n?e:"values"==n?t[e]:[e,t[e]])},"values");rt.Arguments=rt.Array,nt("keys"),nt("values"),nt("entries");for(var kt=V("iterator"),Mt=V("toStringTag"),Ct=rt.Array,Et={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Ft=lt(Et),It=0;It<Ft.length;It++){var Dt,Rt=Ft[It],Vt=Et[Rt],Bt=g[Rt],Gt=Bt&&Bt.prototype;if(Gt&&(Gt[kt]||S(Gt,kt,Ct),Gt[Mt]||S(Gt,Mt,Rt),rt[Rt]=Ct,Vt))for(Dt in At)Gt[Dt]||j(Gt,Dt,At[Dt],!0)}var zt,Nt,Ht,Kt;zt="keys",Nt=function(){return function(t){return lt(k(t))}},Ht=(v.Object||{})[zt]||Object[zt],(Kt={})[zt]=Nt(Ht),T(T.S+T.F*e(function(){Ht(1)}),"Object",Kt);var Ut={alt:i18next.t("alt",{ns:"line"}),aspectRatio:3.8,margin:{top:20,right:10,bottom:50,left:50},filterData:function(t){var e=t;return Object.keys(e[0]).slice(1).map(function(n){return{id:n,data:e.map(function(t){return{year:t.year,value:t[n]}})}})},x:{ticks:10,getValue:function(t){return new Date(t.year+"-01")},getText:function(t){return t.year}},y:{ticks:3,getValue:function(t){return t.value},getText:function(t){return t.value}},z:{label:i18next.t("z_label",{ns:"line"}),getId:function(t){return t.id},getKeys:function(t){var n=Object.keys(t);return n.splice(n.indexOf("keys"),1),n},getClass:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return this.z.getId.apply(this,n)},getDataPoints:function(t){return t.data},getText:function(t){return i18next.t(t.id,{ns:"line"})}},datatable:!1,width:600},Wt={aspectRatio:19/3,margin:{top:30,right:0,bottom:0,left:120},alt:i18next.t("alt",{ns:"commodities"}),filterData:function(t){var i={};return t.map(function(t){var n=Object.keys(t);n.splice(n.indexOf("year"),1);for(var e=0;e<n.length;e++){var r=n[e];i[r]||(i[r]=[]),i[r].push({year:t.year,value:t[r]})}}),Object.keys(i).map(function(t){return{id:t,dataPoints:i[t]}})},x:{getValue:function(t){return t.year},getText:function(t){return t.year}},r:{inverselyProportional:!1,getValue:function(t){return t.value}},z:{getId:function(t){return t.id},getClass:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return this.z.getId.apply(this,n)},getText:function(t){return i18next.t(t.id,{ns:"commodities"})},getDataPoints:function(t){return t.dataPoints}},width:900};function qt(e,t){var n=300-63-0,r=30-0-0,i=d3.select(t).select("svg").attr("width",n).attr("height",r).style("vertical-align","middle").attr("transform","translate(345,30)").selectAll("rect").data(e).enter().append("g"),o=[0,20],a=[130,150];i.append("line").attr("x1",function(t,n){return 0===n?o[0]:a[0]}).attr("x2",function(t,n){return 0===n?o[1]:a[1]}).attr("y1",13).attr("y2",13).attr("class",function(t,n){return"legendLine "+e[n]+"to"}),i.append("text"),d3.select(t).selectAll("text").text(function(t,n){return 0===n?e[0]+" to "+e[1]:e[1]+" to "+e[0]}).attr("y",18).attr("x",function(t,n){return[25,155][n]}).style("display",function(){return"inline"})}var Qt={},$t="ATR",Jt="meat",Xt=["ATR","ON","QC","MB","SK","AB","BC"].filter(function(t){return t!==$t}),Yt=d3.select("#pair1").append("svg").attr("id","svg_pair1"),Zt=d3.select("#pair2").append("svg").attr("id","svg_pair2"),tn=d3.select("#pair3").append("svg").attr("id","svg_pair3"),nn=d3.select("#pair4").append("svg").attr("id","svg_pair4"),en=d3.select("#pair5").append("svg").attr("id","svg_pair5"),rn=d3.select("#pair6").append("svg").attr("id","svg_pair6"),on=d3.select("#commgrid").append("svg").attr("id","svg_commgrid");function an(t){d3.select("#commTableTitle").text("Total tonnage from all origins to all destinations (x 1M) for 10 commodities"),d3.json("data/rail/commdata_allOrig_allDest.json",function(t,n){console.log("sort the data!"),bubbleTable(on,Wt,n)})}i18n.load(["src/i18n"],function(){Ut.x.label=i18next.t("x_label",{ns:"railArea"}),Ut.y.label=i18next.t("y_label",{ns:"railArea"}),d3.json("data/rail/"+Jt+"_"+$t+".json",function(t,n){for(var u=(Qt[$t]=n).length,e=function(o){var a=Xt[o];d3.json("data/rail/"+Jt+"_"+a+".json",function(t,n){Qt[a]=n;for(var e=[],r=0;r<u;r++){var i;e.push((c(i={year:Qt[a][r].year},$t+"to"+a,Qt[$t][r][a]),c(i,a+"to"+$t,Qt[a][r][$t]),i))}0==o?(lineChart(Yt,Ut,e),qt([$t,a],"#legend1")):1==o?(lineChart(Zt,Ut,e),qt([$t,a],"#legend2")):2==o?(lineChart(tn,Ut,e),qt([$t,a],"#legend3")):3==o?(lineChart(nn,Ut,e),qt([$t,a],"#legend4")):4==o?(lineChart(en,Ut,e),qt([$t,a],"#legend5")):5==o&&(lineChart(rn,Ut,e),qt([$t,a],"#legend6"))})},r=0;r<Xt.length;r++)e(r)}),an()}),$(document).on("change",function(t){"commodity"===t.target.id&&(Jt=document.getElementById("commodity").value),"region"===t.target.id&&($t=document.getElementById("region").value),Qt[$t]?lineChart(Yt,Ut,Qt[$t]):d3.json("data/rail/rail_"+Jt+"_orig"+$t+"_all_dest.json",function(t,n){Qt[$t]=n})})}();