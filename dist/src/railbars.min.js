!function(){"use strict";function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(t){g(e,t,n[t])})}return e}function t(t,e){return t(e={exports:{}},e.exports),e.exports}var v=t(function(t){var e=t.exports={version:"2.6.3"};"number"==typeof __e&&(__e=e)}),h=(v.version,t(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)})),i=t(function(t){var e="__core-js_shared__",n=h[e]||(h[e]={});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:v.version,mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),e=0,n=Math.random(),u=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+n).toString(36))},r=t(function(t){var e=i("wks"),n=h.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:u)("Symbol."+t))}).store=e}),o=function(t){return"object"==typeof t?null!==t:"function"==typeof t},c=function(t){if(!o(t))throw TypeError(t+" is not an object!");return t},l=function(t){try{return!!t()}catch(t){return!0}},s=!l(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),f=h.document,p=o(f)&&o(f.createElement),y=function(t){return p?f.createElement(t):{}},d=!s&&!l(function(){return 7!=Object.defineProperty(y("div"),"a",{get:function(){return 7}}).a}),m=Object.defineProperty,b={f:s?Object.defineProperty:function(t,e,n){if(c(t),e=function(t,e){if(!o(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!o(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!o(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!o(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e,!0),c(n),d)try{return m(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},j=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},T=s?function(t,e,n){return b.f(t,e,j(1,n))}:function(t,e,n){return t[e]=n,t},x=r("unscopables"),O=Array.prototype;null==O[x]&&T(O,x,{});var S=function(t){O[x][t]=!0},w=function(t,e){return{value:e,done:!!t}},A={},_={}.toString,P=function(t){return _.call(t).slice(8,-1)},k=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==P(t)?t.split(""):Object(t)},L=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},M=function(t){return k(L(t))},I={}.hasOwnProperty,C=function(t,e){return I.call(t,e)},E=t(function(t){var o=u("src"),e="toString",n=Function[e],a=(""+n).split(e);v.inspectSource=function(t){return n.call(t)},(t.exports=function(t,e,n,r){var i="function"==typeof n;i&&(C(n,"name")||T(n,"name",e)),t[e]!==n&&(i&&(C(n,o)||T(n,o,t[e]?""+t[e]:a.join(String(e)))),t===h?t[e]=n:r?t[e]?t[e]=n:T(t,e,n):(delete t[e],T(t,e,n)))})(Function.prototype,e,function(){return"function"==typeof this&&this[o]||n.call(this)})}),D=function(r,i,t){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(r),void 0===i)return r;switch(t){case 1:return function(t){return r.call(i,t)};case 2:return function(t,e){return r.call(i,t,e)};case 3:return function(t,e,n){return r.call(i,t,e,n)}}return function(){return r.apply(i,arguments)}},R="prototype",B=function(t,e,n){var r,i,o,a,u=t&B.F,c=t&B.G,l=t&B.S,s=t&B.P,f=t&B.B,p=c?h:l?h[e]||(h[e]={}):(h[e]||{})[R],y=c?v:v[e]||(v[e]={}),d=y[R]||(y[R]={});for(r in c&&(n=e),n)o=((i=!u&&p&&void 0!==p[r])?p:n)[r],a=f&&i?D(o,h):s&&"function"==typeof o?D(Function.call,o):o,p&&E(p,r,o,t&B.U),y[r]!=o&&T(y,r,a),s&&d[r]!=o&&(d[r]=o)};h.core=v,B.F=1,B.G=2,B.S=4,B.P=8,B.B=16,B.W=32,B.U=64,B.R=128;var F=B,V=Math.ceil,G=Math.floor,z=function(t){return isNaN(t=+t)?0:(0<t?G:V)(t)},N=Math.min,H=function(t){return 0<t?N(z(t),9007199254740991):0},K=Math.max,U=Math.min,W=function(l){return function(t,e,n){var r,i,o,a=M(t),u=H(a.length),c=(i=u,(r=z(r=n))<0?K(r+i,0):U(r,i));if(l&&e!=e){for(;c<u;)if((o=a[c++])!=o)return!0}else for(;c<u;c++)if((l||c in a)&&a[c]===e)return l||c||0;return!l&&-1}},q=i("keys"),Q=function(t){return q[t]||(q[t]=u(t))},J=W(!1),X=Q("IE_PROTO"),Y="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Z=Object.keys||function(t){return function(t,e){var n,r=M(t),i=0,o=[];for(n in r)n!=X&&C(r,n)&&o.push(n);for(;e.length>i;)C(r,n=e[i++])&&(~J(o,n)||o.push(n));return o}(t,Y)},tt=s?Object.defineProperties:function(t,e){c(t);for(var n,r=Z(e),i=r.length,o=0;o<i;)b.f(t,n=r[o++],e[n]);return t},et=h.document,nt=et&&et.documentElement,rt=Q("IE_PROTO"),it=function(){},ot="prototype",at=function(){var t,e=y("iframe"),n=Y.length;for(e.style.display="none",nt.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),at=t.F;n--;)delete at[ot][Y[n]];return at()},ut=Object.create||function(t,e){var n;return null!==t?(it[ot]=c(t),n=new it,it[ot]=null,n[rt]=t):n=at(),void 0===e?n:tt(n,e)},ct=b.f,lt=r("toStringTag"),st=function(t,e,n){t&&!C(t=n?t:t.prototype,lt)&&ct(t,lt,{configurable:!0,value:e})},ft={};T(ft,r("iterator"),function(){return this});var pt=function(t){return Object(L(t))},yt=Q("IE_PROTO"),dt=Object.prototype,gt=Object.getPrototypeOf||function(t){return t=pt(t),C(t,yt)?t[yt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?dt:null},vt=r("iterator"),ht=!([].keys&&"next"in[].keys()),mt="values",bt=function(){return this},xt=function(t,e,n,r,i,o,a){var u,c,l;c=e,l=r,(u=n).prototype=ut(ft,{next:j(1,l)}),st(u,c+" Iterator");var s,f,p,y=function(t){if(!ht&&t in h)return h[t];switch(t){case"keys":case mt:return function(){return new n(this,t)}}return function(){return new n(this,t)}},d=e+" Iterator",g=i==mt,v=!1,h=t.prototype,m=h[vt]||h["@@iterator"]||i&&h[i],b=m||y(i),x=i?g?y("entries"):b:void 0,O="Array"==e&&h.entries||m;if(O&&(p=gt(O.call(new t)))!==Object.prototype&&p.next&&(st(p,d,!0),"function"!=typeof p[vt]&&T(p,vt,bt)),g&&m&&m.name!==mt&&(v=!0,b=function(){return m.call(this)}),(ht||v||!h[vt])&&T(h,vt,b),A[e]=b,A[d]=bt,i)if(s={values:g?b:y(mt),keys:o?b:y("keys"),entries:x},a)for(f in s)f in h||E(h,f,s[f]);else F(F.P+F.F*(ht||v),e,s);return s}(Array,"Array",function(t,e){this._t=M(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,w(1)):w(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values");A.Arguments=A.Array,S("keys"),S("values"),S("entries");for(var Ot=r("iterator"),jt=r("toStringTag"),Tt=A.Array,St={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},wt=Z(St),At=0;At<wt.length;At++){var _t,Pt=wt[At],kt=St[Pt],Lt=h[Pt],Mt=Lt&&Lt.prototype;if(Mt&&(Mt[Ot]||T(Mt,Ot,Tt),Mt[jt]||T(Mt,jt,Pt),A[Pt]=Tt,kt))for(_t in xt)Mt[_t]||E(Mt,_t,xt[_t],!0)}var It,Ct,Et,Dt;It="keys",Ct=function(){return function(t){return Z(pt(t))}},Et=(v.Object||{})[It]||Object[It],(Dt={})[It]=Ct(Et),F(F.S+F.F*l(function(){Et(1)}),"Object",Dt);var Rt=Array.isArray||function(t){return"Array"==P(t)},Bt=r("species"),Ft=function(t,e){return Rt(n=t)&&("function"!=typeof(r=n.constructor)||r!==Array&&!Rt(r.prototype)||(r=void 0),o(r)&&null===(r=r[Bt])&&(r=void 0)),new(void 0===r?Array:r)(e);var n,r},Vt=function(f,t){var p=1==f,y=2==f,d=3==f,g=4==f,v=6==f,h=5==f||v,m=t||Ft;return function(t,e,n){for(var r,i,o=pt(t),a=k(o),u=D(e,n,3),c=H(a.length),l=0,s=p?m(t,c):y?m(t,0):void 0;l<c;l++)if((h||l in a)&&(i=u(r=a[l],l,o),f))if(p)s[l]=i;else if(i)switch(f){case 3:return!0;case 5:return r;case 6:return l;case 2:s.push(r)}else if(g)return!1;return v?-1:d||g?g:s}},Gt=function(t,e){return!!t&&l(function(){e?t.call(null,function(){},1):t.call(null)})},zt=Vt(1);F(F.P+F.F*!Gt([].map,!0),"Array",{map:function(t){return zt(this,t,arguments[1])}});var Nt=Vt(2);F(F.P+F.F*!Gt([].filter,!0),"Array",{filter:function(t){return Nt(this,t,arguments[1])}});var Ht=W(!1),Kt=[].indexOf,Ut=!!Kt&&1/[1].indexOf(1,-0)<0;F(F.P+F.F*(Ut||!Gt(Kt)),"Array",{indexOf:function(t){return Ut?Kt.apply(this,arguments)||0:Ht(this,t,arguments[1])}});var Wt={alt:i18next.t("alt",{ns:"line"}),aspectRatio:3.8,margin:{top:20,right:10,bottom:50,left:70},filterData:function(t){var n=t;return Object.keys(n[0]).slice(1).map(function(e){return{id:e,data:n.map(function(t){return{year:t.year,value:t[e]}})}})},x:{ticks:10,getValue:function(t){return new Date(t.year+"-01")},getText:function(t){return t.year}},y:{ticks:3,getValue:function(t){return 1*t.value/1e3},getText:function(t){return t.value}},z:{label:i18next.t("z_label",{ns:"line"}),getId:function(t){return t.id},getKeys:function(t){var e=Object.keys(t);return e.splice(e.indexOf("keys"),1),e},getClass:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.z.getId.apply(this,e)},getDataPoints:function(t){return t.data},getText:function(t){return i18next.t(t.id,{ns:"line"})}},datatable:!1,width:400},qt={aspectRatio:1,margin:{top:50,left:100,bottom:150},x:{label:i18next.t("x_label",{ns:"railBar"}),getId:function(t){return t.year},getValue:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.x.getId.apply(this,e)},getClass:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.x.getId.apply(this,e)},getTickText:function(t){return i18next.t(t,{ns:"railBar"})}},y:{label:i18next.t("y_label",{ns:"railBar"}),getValue:function(t){return t.value},getText:function(t){return Math.round(t.value)},ticks:5},z:{getId:function(t){return t.category},getClass:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.z.getId.apply(this,e)},getDataPoints:function(t){return t.values},getText:function(t){return i18next.t(t.id,{ns:"railBar"})}},width:900},Qt={aspectRatio:19/3,margin:{top:30,right:0,bottom:0,left:120},alt:i18next.t("alt",{ns:"commodities"}),filterData:function(t){var i={};return t.map(function(t){var e=Object.keys(t);e.splice(e.indexOf("year"),1);for(var n=0;n<e.length;n++){var r=e[n];i[r]||(i[r]=[]),i[r].push({year:t.year,value:t[r]})}}),Object.keys(i).map(function(t){return{id:t,dataPoints:i[t]}})},x:{getValue:function(t){return t.year},getText:function(t){return t.year}},r:{inverselyProportional:!1,getValue:function(t){return t.value}},z:{getId:function(t){return t.id},getClass:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.z.getId.apply(this,e)},getText:function(t){return i18next.t(t.id,{ns:"commodities"})},getDataPoints:function(t){return t.dataPoints}},width:900};for(var $t,Jt="ON",Xt="chems",Yt="AT",Zt=["AT","ON","QC","MB","SK","AB","BC"],te=function(){return Zt.filter(function(t){return t!==Jt})},ee=d3.select("#pair1").append("svg").attr("id","svg_pair1"),ne=[],re=0;re<te().length;re++)ne.push(d3.select("#bar".concat(re)).append("svg").attr("id","svg_bar".concat(re)));for(var ie=[],oe=0;oe<te().length;oe++)ie.push("#bar".concat(oe,"Title"));var ae=d3.select("#commgrid").append("svg").attr("id","svg_commgrid");function ue(t){d3.select("#commTableTitle").text("Total tonnage from all origins to all destinations (x 1M) for 10 commodities"),d3.json("data/rail/commdata_allOrig_allDest.json",function(t,e){console.log("sort the data!"),bubbleTable(ae,Qt,e)})}function ce(e){var n=this;return[{category:"".concat(this.selectedRegion,"to").concat(this.targetRegion),values:Object.keys(e).map(function(t){return{year:t,value:e[parseInt(t,10)][n.targetRegion]/1e3}})}]}function le(t){var e=i18next.t(Jt,{ns:"railGeography"}),n=i18next.t(Xt,{ns:"commodities"});d3.select("#barChartTitle").text("".concat(n," transported by rail from ").concat(e," to all destinations"));var r=i18next.t(te()[t],{ns:"railGeography"});d3.select(ie[t]).text(r)}i18n.load(["src/i18n"],function(){Wt.x.label=i18next.t("x_label",{ns:"railArea"}),Wt.y.label=i18next.t("y_label",{ns:"railArea"}),qt.x.label=i18next.t("x_label",{ns:"railBar"}),qt.y.label=i18next.t("y_label",{ns:"railBar"}),d3.json("data/rail/"+Jt+"_"+Xt+".json",function(t,d){console.log("json1: ",d);var e=te();$t=[0,65];var n=a({},qt,{filterData:ce});qt.y.getDomain=function(){return $t};for(var r=0;r<e.length;r++){var i=e[r],o=ne[r];barChart(o,a({},n,{selectedRegion:Jt,targetRegion:i}),d),d3.selectAll(".railBar").selectAll(".x.axis").selectAll(".tick").selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end"),le(r)}d3.json("data/rail/AT_"+Xt+".json",function(t,e){for(var n,r,i,o,a,u,c,l=Object.keys(d).length,s=[],f=0;f<l;f++){var p,y=Object.keys(d)[f];s.push((g(p={year:y},Jt+"to"+Yt,d[y].AT),g(p,"ATto"+Jt,e[y][Jt]),p))}console.log("arrPair: ",s),lineChart(ee,Wt,s),n=[Jt,Yt],r="#legend1",i=637,o=30,a=d3.select(r).select("svg").attr("width",i).attr("height",o).style("vertical-align","middle").attr("transform","translate(345,0)").selectAll("rect").data(n).enter().append("g"),u=[300,320],c=[430,450],a.append("line").attr("x1",function(t,e){return 0===e?u[0]:c[0]}).attr("x2",function(t,e){return 0===e?u[1]:c[1]}).attr("y1",9).attr("y2",9).attr("class",function(t,e){return(0===e?"legendLine ":"legendLine2 ")+n[e]+"to"}),a.append("text"),d3.select(r).selectAll("text").text(function(t,e){return 0===e?n[0]+" to "+n[1]:n[1]+" to "+n[0]}).attr("y",12).attr("x",function(t,e){return[325,455][e]}).style("display",function(){return"inline"})})}),ue()}),$(document).on("change",function(t){"commodity"===t.target.id&&(Xt=document.getElementById("commodity").value),"region"===t.target.id&&(Jt=document.getElementById("region").value)})}();